<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="description" content="A versatile to-do app for busy professionals balancing work and home life" />
    <meta name="theme-color" content="#3f6df6" />

    <!-- iOS-specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="MedTodo" />

    <title>Todo List - Medical Professional Edition</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icon.svg" />
    <link rel="icon" type="image/svg+xml" href="icon.svg" />
  </head>
  <body>
    <!-- Authentication Container -->
    <div id="auth-container" class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <img src="icon.svg" alt="MedTodo" class="auth-logo" />
          <h1>MedTodo</h1>
          <p>Medical Professional Todo List</p>
        </div>

        <!-- Sign In Form -->
        <div id="signin-form" class="auth-form active">
          <h2>Sign In</h2>
          <form id="signin-email-form">
            <div class="field">
              <label for="signin-email">Email</label>
              <input type="email" id="signin-email" placeholder="your@email.com" required />
            </div>
            <div class="field">
              <label for="signin-password">Password</label>
              <input type="password" id="signin-password" placeholder="••••••••" required />
            </div>
            <button type="submit" class="primary full-width">Sign In</button>
          </form>

          <div class="auth-divider">
            <span>or</span>
          </div>

          <button id="google-signin-btn" class="secondary full-width google-btn">
            <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
              <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
              <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
              <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
            </svg>
            Continue with Google
          </button>

          <p class="auth-toggle">
            Don't have an account? <a href="#" id="show-signup">Sign up</a>
          </p>

          <p class="auth-offline">
            <a href="#" id="use-offline">Continue without account (offline only)</a>
          </p>
        </div>

        <!-- Sign Up Form -->
        <div id="signup-form" class="auth-form">
          <h2>Create Account</h2>
          <form id="signup-email-form">
            <div class="field">
              <label for="signup-email">Email</label>
              <input type="email" id="signup-email" placeholder="your@email.com" required />
            </div>
            <div class="field">
              <label for="signup-password">Password</label>
              <input type="password" id="signup-password" placeholder="••••••••" minlength="6" required />
            </div>
            <div class="field">
              <label for="signup-password-confirm">Confirm Password</label>
              <input type="password" id="signup-password-confirm" placeholder="••••••••" minlength="6" required />
            </div>
            <button type="submit" class="primary full-width">Create Account</button>
          </form>

          <div class="auth-divider">
            <span>or</span>
          </div>

          <button id="google-signup-btn" class="secondary full-width google-btn">
            <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
              <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
              <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
              <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
            </svg>
            Sign up with Google
          </button>

          <p class="auth-toggle">
            Already have an account? <a href="#" id="show-signin">Sign in</a>
          </p>
        </div>

        <div id="auth-error" class="auth-error"></div>
      </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="app" style="display: none;">
      <header class="app__header">
        <div>
          <h1>Todo List</h1>
          <p>Track tasks in your browser and sync with Obsidian using Markdown checklists.</p>
        </div>
        <div class="app__meta">
          <div class="user-info">
            <span id="user-email" class="user-email"></span>
            <span id="sync-status" class="sync-status"></span>
          </div>
          <span id="task-count">0 tasks</span>
          <button id="sign-out-btn" class="secondary">Sign Out</button>
          <button id="clear-completed" class="secondary">Clear completed</button>
        </div>
      </header>

      <div class="layout">
        <main class="main">
          <section class="card">
            <form id="task-form" autocomplete="off">
              <label class="field">
                <span>New task</span>
                <input id="task-input" type="text" placeholder="Add a task" required />
              </label>
              <label class="field">
                <span>Notes</span>
                <input id="task-notes" type="text" placeholder="Optional details" />
              </label>
              <div class="form-row">
                <label class="field">
                  <span>Priority</span>
                  <select id="task-priority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                  </select>
                </label>
                <label class="field">
                  <span>Category</span>
                  <select id="task-category">
                    <option value="work">Work</option>
                    <option value="home">Home</option>
                    <option value="research">Research</option>
                    <option value="clinical">Clinical</option>
                    <option value="teaching">Teaching</option>
                  </select>
                </label>
                <label class="field">
                  <span>Tag</span>
                  <input id="task-tag" type="text" placeholder="e.g. #urgent" />
                </label>
              </div>
              <div class="form-row">
                <label class="field">
                  <span>Due date</span>
                  <input id="task-due-date" type="date" />
                </label>
                <label class="field">
                  <span>Due time</span>
                  <input id="task-due-time" type="time" />
                </label>
                <label class="field">
                  <span>Recurrence</span>
                  <select id="task-recurrence">
                    <option value="">None</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </label>
                <button type="submit" class="primary">Add task</button>
              </div>
            </form>
          </section>

          <section class="card">
            <div class="filter-row">
              <div class="filters" role="group" aria-label="Filter tasks">
                <button class="filter active" data-filter="all">All</button>
                <button class="filter" data-filter="active">Active</button>
                <button class="filter" data-filter="completed">Completed</button>
              </div>
              <input id="search-input" type="search" placeholder="Search tasks" />
            </div>
            <div class="filter-row">
              <div class="category-filters" role="group" aria-label="Filter by category">
                <button class="category-filter active" data-category="">All Categories</button>
                <button class="category-filter" data-category="work">Work</button>
                <button class="category-filter" data-category="home">Home</button>
                <button class="category-filter" data-category="research">Research</button>
                <button class="category-filter" data-category="clinical">Clinical</button>
                <button class="category-filter" data-category="teaching">Teaching</button>
              </div>
            </div>
            <ul id="task-list" class="task-list"></ul>
          </section>

          <section class="card">
            <div class="card__header">
              <h2>Quick Capture</h2>
            </div>
            <p class="muted">
              Quickly add a task with smart parsing. Use !high, !medium, !low for priority, #tag for tags, and category: for categories.
            </p>
            <div class="quick-capture">
              <input id="quick-capture-input" type="text" placeholder="e.g., Call Dr. Smith tomorrow 2pm #urgent !high category:clinical" />
              <button id="quick-capture-btn" class="primary">Quick Add</button>
            </div>
          </section>

          <section class="card">
            <div class="card__header">
              <h2>Task Templates</h2>
            </div>
            <p class="muted">
              Pre-configured templates for common tasks.
            </p>
            <div class="template-buttons">
              <button class="template-btn secondary" data-template="patient-referral">New Patient Referral</button>
              <button class="template-btn secondary" data-template="research-review">Research Paper Review</button>
              <button class="template-btn secondary" data-template="conference-prep">Conference Prep</button>
              <button class="template-btn secondary" data-template="family-event">Family Event</button>
            </div>
          </section>

          <section class="card">
            <div class="card__header">
              <h2>Obsidian Integration</h2>
              <button id="export-markdown" class="secondary">Export to Markdown</button>
            </div>
            <p class="muted">
              Use Markdown checklists to sync with Obsidian. Paste a checklist below and import it,
              or copy the exported list into an Obsidian note.
            </p>
            <textarea id="markdown-area" rows="8" placeholder="- [ ] Example task"></textarea>
            <div class="card__actions">
              <button id="import-markdown" class="primary">Import from Markdown</button>
              <button id="copy-markdown" class="secondary">Copy to clipboard</button>
            </div>
          </section>
        </main>

        <aside class="sidebar">
          <section class="card calendar">
            <div class="card__header">
              <h2>Calendar</h2>
              <button id="clear-date-filter" class="secondary">Clear date</button>
            </div>
            <label class="field">
              <span>Pick a date</span>
              <input id="calendar-date" type="date" />
            </label>
            <p class="muted" id="calendar-summary">No date selected.</p>
            <p class="muted" id="calendar-empty">No due dates yet. Add one to see it here.</p>
            <ul id="calendar-list" class="calendar-list"></ul>
          </section>
        </aside>
      </div>
    </div>

    <!-- Floating Quick Add Button -->
    <button id="floating-quick-add" class="floating-btn" title="Quick Add Task">+</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- App Scripts -->
    <script type="module" src="auth.js"></script>
    <script type="module" src="app.js"></script>
    <script type="module" src="auth-ui.js"></script>

    <script>
      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('Service Worker registered', reg.scope))
          .catch(err => console.log('Service Worker registration failed', err));
      }
    </script>
  </body>
</html>
